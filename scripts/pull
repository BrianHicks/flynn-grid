#!/bin/sh
# 
# This script does a rebase pull on this repo and sub repos.
# It will also clone sub repos that have not been cloned yet.
#
set -e
cd $(dirname $0)/..
for gitdir in $(find . -not -path "\./\.*" -name ".git"); do
	path=$(dirname $gitdir)
	cd $path
	[ ! -z $(git config --get remote.origin.url) ] && git pull --rebase origin master
	cd -
done
for subrepo in $(find . -not -path "\./\.*" -name ".subrepo"); do
	path=$(dirname $subrepo)
	if [ ! -d "$path/.git" ]; then
		repo=$(cat $subrepo)
		rm -rf $subrepo
		git clone $repo $path
	fi
done